<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>genereer rooster</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css"
          integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"
            integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS"
            crossorigin="anonymous"></script>
    <link rel="stylesheet" type="text/css" th:href="@{/css/index.css}"/>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>


</head>
<body>
<div class="container">
    <nav class="navbar navbar-default">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">COHORT-ROOSTER BEHEER </a>
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav">
                    <li><a class="nav-link" href=#></a></li>
                    <li><a class="nav-link" href=#></a></li>
                    <li><a class="nav-link" href=#></a></li>
                </ul>
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <form th:action="@{/logout}" method="post">
                            <button type="submit" class="btn btn-lg btn-primary">Log Out</button>
                        </form>
                    </li>
                </ul>

            </div>
        </div>
    </nav>
</div>

<div class="table-responsive col-sm-10">
    <table id="generateSchedule" class="table table-bordered">
        <h3 class="cohortBeheerTable">COHORT ROOSTER PLANNING</h3>
        <tablehead>
            <thead class="thead-dark">
            <tr>
                <th>cohort</th>
                <th>datum</th>
                <th>dag</th>
                <th>dagdeel</th>
                <th>planning</th>
                <th>resultaat check/opslag</th>
                <th>check op conflict</th>
                <th>planning opslaan</th>
            </tr>
            </thead>
        </tablehead>

        <tablebody>
            <tr th:each="schedule:${cohortschedule}" th:data-ID="${schedule.getId()}" th:id="tr_tag">
                <form id="${schedule.getId()}" action="#" th:action="@{/generateCohortSchedule}"
                      th:object="${cohortschedule}"
                      method="post">

                    <td>
                        <input th:with="cohort=${schedule.getCohort().getCohortId()}" type="${schedule}" class="cohort"
                               NAME="cohort" th:data-ID="${schedule.getId()}" th:id="cohort" style="background-color:
                        transparent;border: #FF1C19" th:value="${schedule.getCohort().getCohortId()}"
                               th:field="${cohort}" readonly/>
                    </td>

                    <td>
                        <input th:with="dateDay=${schedule.getId()}" type="${schedule}" class="date" NAME="date"
                               th:data-ID="${schedule.getId()}" th:id="dateDay" style="background-color:
                        transparent;border: #FF1C19" th:value="${schedule.getDate()}" th:field="${date}" readonly/>
                    </td>

                    <td>
                        <input th:with="day=${schedule.getId()}" type="${schedule}" class="day" NAME="day"
                               th:data-ID="${schedule.getId()}" th:id="day" style="background-color:
                        transparent;border: #FF1C19" th:value="${schedule.getDay()}" th:field="${day}" readonly/>
                    </td>

                    <td>
                        <input th:with="datepart=${schedule.getId()}" type="${schedule}" class="daypart" NAME="daypart"
                               th:data-ID="${schedule.getId()}" th:id="daypart" style="background-color:
                        transparent;border: #FF1C19" th:value="${schedule.getDaypart()}" th:field="${daypart}"
                               readonly/>
                    </td>

                    <td>
                        <form>
                            <div>
                                <select th:id="subjectVariable" class="subject" th:data-ID="${schedule.getId()}">
                                    <option>selecteer vak</option>
                                    <option th:each="subject: ${subjects}" th:value="${subject[0]}"
                                            th:text="${subject[2]}">
                                </select>
                            </div>
                            <br>
                            <div>
                                <select th:id="teacherVariable" class="teacher" th:data-ID="${schedule.getId()}">
                                    <option>selecteer docent</option>
                                    <option th:each="teacher: ${teachers}" th:value="${teacher[0]}"
                                            th:text="${teacher[3]}">
                                </select>
                            </div>

                        </form>
                    </td>


                    <td th:with="textBox=${schedule.getId()}" th:id="textBox" th:data-ID="${schedule.getId()}"
                        class="Box">
                        <div>
                            <form th:name="constraint">
                            </form>
                        </div>
                    </td>


                    <td>
                        <div>
                            <button th:id="checkButton" type="submit" th:data-ID="${schedule.getId()}"
                                    class="checkButton" th:value="check" name="check"
                                    th:form="${schedule.getId()}">check
                            </button>
                        </div>
                    </td>

                    <td>

                        <button th:id="saveButton" type="submit" th:data-ID="${schedule.getId()}" class="saveButton"
                                th:value="opslaan" name="opslaan"
                                th:form="${schedule.getId()}">opslaan
                        </button>

                    </td>
                </form>
            </tr>
        </tablebody>
    </table>
</div>
</body>
<script th:inline="javascript">
    cohortnr = $('#cohort').val();
    console.log(cohortnr);
    dateDay = $('#dateDay').val();
    console.log(dateDay);
    day = $("#day").val();
    console.log(day);
    daypart = $('#daypart').val();
    console.log(daypart);


    <!--Select only the value that is selected in the dropdownmenu -->
    $(".subject").on('change', function () {
        subjectnr = $(this).val();
        console.log(subjectnr);
    });

    $(".teacher").on('change', function () {
        teachernr = $(this).val();
        console.log(teachernr);
    });


    $(".checkButton").click(function (e) {
        e.preventDefault();
        thisId = $(this).data("id");
        console.log("CHECKBUTTON_ID = :" + thisId);

        var textBoxId = thisId - 1;
        console.log("childElement = :" + textBoxId);
        var x = document.getElementsByClassName("Box")[textBoxId];
        console.log("elementBYClassName : " + x);


        console.log(e)
        $.ajax({
            type: "POST",
            url: "/generateCohortSchedule/check/",
            data: {
                "cohortnr": document.getElementsByClassName("cohort")[textBoxId].value,
                "dateDay": document.getElementsByClassName("date")[textBoxId].value,
                "day": document.getElementsByClassName("day")[textBoxId].value,
                "daypart": document.getElementsByClassName("daypart")[textBoxId].value,
                "subjectnr": document.getElementsByClassName("subject")[textBoxId].value,
                "teachernr": document.getElementsByClassName("teacher")[textBoxId].value,
                "scheduleId": thisId,
                "button": "check"
            },
            success: function (result) {
                if (result == "OK") {
                    x.style.background = "PaleGreen";
                    x.innerHTML = "kan opgeslagen worden";
                } else if (result == "NotAvailable") {
                    x.style.background = "#ff8000";
                    x.innerHTML ="Docent is dit dagdeel" + "<br>" + "niet beschikbaar";
                } else if (result == "NoHoursLeft") {
                    x.style.background = "#ff8000";
                    x.innerHTML = "Docenturen zijn overschreden";
                } else {
                    x.style.background = "#ff8000";
                    x.innerHTML = "Docent geeft dit vak liever niet";

                }

            },
            error: function (result) {
                alert('selecteer docent/vak');
            }
        });
    });


    $(".saveButton").click(function (e) {
        e.preventDefault();
        thisId = $(this).data("id");
        console.log("SAVEBUTTON_ID = :" + thisId);

        var textBoxId = thisId - 1;
        console.log("childElement = :" + textBoxId);
        var x = document.getElementsByClassName("Box")[textBoxId];
        console.log("elementBYClassName : " + x);


        console.log(e)
        $.ajax({
            type: "POST",
            url: "/generateCohortSchedule/check/",
            data: {
                "cohortnr": document.getElementsByClassName("cohort")[textBoxId].value,
                "dateDay": document.getElementsByClassName("date")[textBoxId].value,
                "day": document.getElementsByClassName("day")[textBoxId].value,
                "daypart": document.getElementsByClassName("daypart")[textBoxId].value,
                "subjectnr": document.getElementsByClassName("subject")[textBoxId].value,
                "teachernr": document.getElementsByClassName("teacher")[textBoxId].value,
                "scheduleId": thisId,
                "button": "save"
            },
            success: function (result) {
                if (result == "OK") {
                    x.style.background = "SpringGreen";
                    x.innerHTML = "opgeslagen";
                } else if (result == "NotAvailable") {
                    x.style.background = "#ff4000";
                    x.innerHTML = "opgeslagen -->"+ "<br>"+ "LET OP: Docent niet beschikbaar";
                } else if (result == "UrenNOK") {"NoHoursLeft"
                    x.style.background = "#ff4000";
                    x.innerHTML = "opgeslagen --> " + "<br>"+ "LET OP: Docenturen overschreden";
                } else {
                    x.style.background = "#ff4000";
                    x.innerHTML = "opgeslagen -->" + "<br>" + "LET OP: Docent geeft dit vak liever niet";

                }

            },
            error: function (result) {
                alert('selecteer docent/vak');
            }
        });
    });


</script>
</html>
